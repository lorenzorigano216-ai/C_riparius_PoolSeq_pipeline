# Workflow for *Chironomus riparius* E&R Pool-Seq Experiment

**Author:** Lorenzo Rigano  
**Year:** 2024  

This repository contains the complete bioinformatic and statistical workflow used in the study  
**“Beyond acute toxicity: evolutionary response by rapid polygenic adaptation to a complex environmental stressor in *Chironomus riparius*”**,  
submitted to *Environmental Toxicology and Chemistry*.

All scripts, software versions, and parameters are provided to ensure full reproducibility and compliance with open science standards.

---

## Data availability

Raw sequencing data and pool mapping files are publicly available at the **European Nucleotide Archive (ENA)** under accession number:

**PRJEB89250**

Non-genomic data (life-cycle endpoints) and all analysis scripts are provided in this repository.

---

## Software and versions

The following software and R packages were used:

- Trimmomatic v0.39  
- FastQC v0.11.9  
- PEAR v0.9.11 (optional paired-end merging)  
- BWA mem v0.7.17  
- Samtools v1.10  
- Picard v2.20.8  
- Qualimap v2.2.1 (optional quality control)  
- PoPoolation v1.2.2  
- PoPoolation2 v1201  
- PoolSeq R package v0.3.5  
- topGO R package v4.4  
- R v4.x  

---

## Repository structure

├── README.md # This file
├── C_riparius_PoolSeq_pipeline.txt # Complete bioinformatic and statistical pipeline
├── data/
│ └── life_cycle_data.csv # Life-cycle endpoint data (mortality, EmT50, fertility, PGR)
└── results/ # Output files generated by the pipeline (optional)

---

## Overview of the workflow

The workflow implemented in `C_riparius_PoolSeq_pipeline.txt` includes the following steps:

1. **Raw read processing**
   - Adapter removal and quality trimming using Trimmomatic  
   - Quality assessment with FastQC  
   - Optional merging of overlapping paired-end reads with PEAR  

2. **Read mapping**
   - Mapping to the *C. riparius* reference genome (v4, unpublished) using BWA mem  
   - Sorting and merging BAM files with Samtools  

3. **Duplicate removal and filtering**
   - PCR duplicate removal using Picard  
   - Filtering for properly paired reads and minimum mapping quality (MAPQ ≥ 20)  

4. **SNP calling and filtering**
   - Mpileup generation with Samtools  
   - Sync file creation using PoPoolation2  
   - Indel removal and coverage-based filtering  

5. **Population genetic analyses**
   - Estimation of nucleotide diversity (π and Watterson’s θ) using PoPoolation  
   - FST and Fisher’s exact tests using PoPoolation2  

6. **Allele frequency change and drift analysis**
   - Allele frequency estimation across generations using the PoolSeq R package  
   - Effective population size (Ne) estimation  
   - Wright–Fisher drift simulations  
   - Chi-square tests comparing observed vs drift-expected allele frequency changes  

7. **Monte Carlo intersection analysis**
   - Monte Carlo simulation (100,000 iterations) to assess significance of observed haplotype intersections relative to random expectations  

8. **Functional enrichment analysis**
   - Gene Ontology (GO) enrichment using the topGO R package (Biological Process ontology)  

9. **Life-cycle endpoint analysis**
   - Statistical analysis of mortality, mean emergence time (EmT50), fertility, and population growth rate (PGR) across seven generations  
   - Linear, polynomial, segmented, and loess models implemented in R  
   - Visualization of replicate-level trajectories and fitted trends  

---

## Reproducibility

All parameters used for each bioinformatic and statistical tool are explicitly specified in `C_riparius_PoolSeq_pipeline.txt`.  
When default parameters were used, this is stated in the script.

The combination of:
- public raw data (ENA),
- complete analysis scripts,
- explicit software versions, and
- documented statistical procedures

allows full reproduction and independent evaluation of the analyses presented in the manuscript.

---

## Contact

For questions regarding the workflow or data, please contact the corresponding author.
